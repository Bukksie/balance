
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>balance.util &#8212; balance  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="balance.weighting_methods" href="balance.weighting_methods.html" />
    <link rel="prev" title="balance.typing" href="balance.typing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="balance.weighting_methods.html" title="balance.weighting_methods"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="balance.typing.html" title="balance.typing"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">balance  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="balance.html" accesskey="U">balance</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">balance.util</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-balance.util">
<span id="balance-util"></span><h1>balance.util<a class="headerlink" href="#module-balance.util" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="balance.util.TruncationFormatter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">TruncationFormatter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#TruncationFormatter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.TruncationFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Logging formatter which truncates the logged message to 500 characters.</p>
<p>This is useful in the cases where the logging message includes objects
— like DataFrames — whose string representation is very long.</p>
<dl class="py method">
<dt class="sig sig-object py" id="balance.util.TruncationFormatter.format">
<span class="sig-name descname"><span class="pre">format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LogRecord</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#TruncationFormatter.format"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.TruncationFormatter.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Format the specified record as text.</p>
<p>The record’s attribute dictionary is used as the operand to a
string formatting operation which yields the returned string.
Before formatting the dictionary, a couple of preparatory steps
are carried out. The message attribute of the record is computed
using LogRecord.getMessage(). If the formatting string uses the
time (as determined by a call to usesTime(), formatTime() is
called to format the event time. If there is exception information,
it is formatted using formatException() and appended to the message.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.add_na_indicator">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">add_na_indicator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_val_obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'_NA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_val_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="_modules/balance/util.html#add_na_indicator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.add_na_indicator" title="Permalink to this definition">¶</a></dt>
<dd><p>If a column in the DataFrame contains NAs, replace these with 0 for
numerical columns or “_NA” for non-numerical columns,
and add another column of an indicator variable for which rows were NA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – The input DataFrame</p></li>
<li><p><strong>replace_val_obj</strong> (<em>str</em><em>, </em><em>optional</em>) – The value to put insteasd of nulls for object columns. Defaults to “_NA”.</p></li>
<li><p><strong>replace_val_num</strong> (<em>int</em><em>, </em><em>optional</em>) – The value to put insteasd of nulls for numeric columns. Defaults to 0.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – Can’t add NA indicator to DataFrame which contains columns which start with ‘_is_na_’</p></li>
<li><p><strong>Exception</strong> – Can’t add NA indicator to columns containing NAs and the value ‘{replace_val_obj}’,</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>New dataframe with additional columns</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.auto_spread">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">auto_spread</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'id'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="_modules/balance/util.html#auto_spread"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.auto_spread" title="Permalink to this definition">¶</a></dt>
<dd><p>Automatically transform a ‘long’ DataFrame into a ‘wide’ DataFrame
by guessing which column should be used as a key, treating all
other columns as values. At the moment, this will only find a single key column</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – </p></li>
<li><p><strong>features</strong> (<em>Optional</em><em>[</em><em>list</em><em>]</em><em>, </em><em>optional</em>) – Defaults to None.</p></li>
<li><p><strong>id</strong> (<em>str</em><em>, </em><em>optional</em>) – Defaults to “id”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.build_model_matrix">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">build_model_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">formula</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor_variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_sparse</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/balance/util.html#build_model_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.build_model_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a model matrix from a formula (using patsy.dmatrix)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – The data from which to create the model matrix (pandas dataframe)</p></li>
<li><p><strong>formula</strong> (<em>str</em><em>, </em><em>optional</em>) – a string representing the formula to use for building the model matrix.
Default is additive formula with all variables in df. Defaults to “.”.</p></li>
<li><p><strong>factor_variables</strong> (<em>LisOptional</em><em>[</em><em>List</em><em>]</em><em>t</em><em>, </em><em>optional</em>) – list of names of factor variables that we use
one_hot_encoding_greater_2 for.
Default is None, in which case no special contrasts are applied
(uses patsy defaults).
one_hot_encoding_greater_2 creates one-hot-encoding for all
categorical variables with more than 2 categories (i.e. the
number of columns will be equal to the number of categories), and only 1
column for variables with 2 levels (treatment contrast).</p></li>
<li><p><strong>return_sparse</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to return a sprse matrix using scipy.sparse.csc_matrix. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – “Variable names cannot contain characters ‘[’ or ‘]’”</p></li>
<li><p><strong>Exception</strong> – “Not all factor variables are contained in df”</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl>
<dt>A dictionary of 2 elements:</dt><dd><ol class="arabic simple">
<li><p>model_matrix - this is a pd dataframe or a csc_matrix (depends on return_sparse), ordered by columns names</p></li>
</ol>
<p>2. model_matrix_columns - A list of the columns names of model_matrix
(We include model_matrix_columns as a separate argument since if we return a sparse X_matrix,
it doesn’t have a columns names argument and these need to be kept separately,
see here:
<a class="reference external" href="https://stackoverflow.com/questions/35086940/how-can-i-give-row-and-column-names-to-scipys-csr-matrix">https://stackoverflow.com/questions/35086940/how-can-i-give-row-and-column-names-to-scipys-csr-matrix</a>.)</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>import pandas as pd
d = {‘a’: [‘a1’,’a2’,’a1’,’a1’], ‘b’: [‘b1’,’b2’,’b3’,’b3’]}
df = pd.DataFrame(data=d)</p>
<p>print(build_model_matrix(df, ‘a’))
# {‘model_matrix’:    a[a1]  a[a2]
# 0    1.0    0.0
# 1    0.0    1.0
# 2    1.0    0.0
# 3    1.0    0.0,
# ‘model_matrix_columns’: [‘a[a1]’, ‘a[a2]’]}</p>
<p>print(build_model_matrix(df, ‘.’))
# {‘model_matrix’:    a[a1]  a[a2]  b[T.b2]  b[T.b3]
# 0    1.0    0.0      0.0      0.0
# 1    0.0    1.0      1.0      0.0
# 2    1.0    0.0      0.0      1.0
# 3    1.0    0.0      0.0      1.0,
# ‘model_matrix_columns’: [‘a[a1]’, ‘a[a2]’, ‘b[T.b2]’, ‘b[T.b3]’]}</p>
<p>print(build_model_matrix(df, ‘.’, factor_variables=[‘a’]))
# {‘model_matrix’:    C(a, one_hot_encoding_greater_2)[a2]  b[T.b2]  b[T.b3]
# 0                                0.0      0.0      0.0
# 1                                1.0      1.0      0.0
# 2                                0.0      0.0      1.0
# 3                                0.0      0.0      1.0,
# ‘model_matrix_columns’: [‘C(a, one_hot_encoding_greater_2)[a2]’, ‘b[T.b2]’, ‘b[T.b3]’]}</p>
<p>print(build_model_matrix(df, ‘a’, return_sparse=True))
# {‘model_matrix’: &lt;4x2 sparse matrix of type ‘&lt;class ‘numpy.float64’&gt;’
# with 4 stored elements in Compressed Sparse Column format&gt;, ‘model_matrix_columns’: [‘a[a1]’, ‘a[a2]’]}
print(build_model_matrix(df, ‘a’, return_sparse=True)[“model_matrix”].toarray())
# [[1. 0.]
# [0. 1.]
# [1. 0.]
# [1. 0.]]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.choose_variables">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">choose_variables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">dfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#choose_variables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.choose_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Return covars which are present in all dfs and also in <cite>variables</cite>
if passed</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*dfs</strong> – balance.Samples or pd.DataFrames</p></li>
<li><p><strong>variables</strong> (<em>Optional</em><em>[</em><em>List</em><em>]</em><em>, </em><em>optional</em>) – which variables to choose. If None, chooses all joint variables in the dfs.. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – _description_</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple of joint variables</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.dot_expansion">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">dot_expansion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">formula</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#dot_expansion"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.dot_expansion" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a formula string by replacing “.” with “summing” all the variables,
If no dot appears, returns the formula as is.</p>
<p>This function is named for the ‘dot’ operators in R, where a formula given
as ‘ ~ .’ means “use all variables in dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>formula</strong> – The formula to expand.</p></li>
<li><p><strong>variables</strong> (<em>List</em>) – List of all variables in the dataframe we build the formula for.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>Exception</strong> – “Variables should not be empty. Please provide a list of strings.”</p></li>
<li><p><strong>Exception</strong> – “Variables should be a list of strings and have to be included.”</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A string formula replacing the ‘.’’ with all variables in variables.
If no ‘.’ is present, then the original formula is returned as is.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>dot_expansion(‘.’, [‘a’,’b’,’c’,’d’]) # (a+b+c+d)
dot_expansion(‘b:(. - a)’, [‘a’,’b’,’c’,’d’]) # b:((a+b+c+d) - a)
dot_expansion(‘a*b’, [‘a’,’b’,’c’,’d’]) # a*b
dot_expansion(‘.’, None) # Raise error</p>
<p>import pandas as pd
d = {‘a’: [‘a1’,’a2’,’a1’,’a1’], ‘b’: [‘b1’,’b2’,’b3’,’b3’],</p>
<blockquote>
<div><p>‘c’: [‘c1’,’c1’,’c2’,’c1’], ‘d’:[‘d1’,’d1’,’d2’,’d3’]}</p>
</div></blockquote>
<p>df = pd.DataFrame(data=d)
dot_expansion(‘.’, df) # Raise error
dot_expansion(‘.’, list(df.columns)) # (a+b+c+d)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.drop_na_rows">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">drop_na_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'sample</span> <span class="pre">object'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Series</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/balance/util.html#drop_na_rows"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.drop_na_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop rows with missing values in sample_df and their corresponding weights, and the same in target_df.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sample_df</strong> (<em>pd.DataFrame</em>) – a dataframe representing the sample or target</p></li>
<li><p><strong>sample_weights</strong> (<em>pd.Series</em>) – design weights for sample or target</p></li>
<li><p><strong>name</strong> (<em>str</em><em>, </em><em>optional</em>) – name of object checked (used for warnings prints). Defaults to “sample object”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – Dropping rows led to empty {name}. Maybe try na_action=’add_indicator’?</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>sample_df, sample_weights without NAs rows</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple[pd.DataFrame, pd.Series]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.fct_lump">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">fct_lump</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="reference internal" href="_modules/balance/util.html#fct_lump"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.fct_lump" title="Permalink to this definition">¶</a></dt>
<dd><p>Lumps infrequent levels into ‘_lumped_other’.
Note that all values with proprtion less than prop output the same value ‘_lumped_other’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> (<em>pd.Series</em>) – pd.series to lump, with dtype of integer, numeric, object, or category (category will be converted to object)</p></li>
<li><p><strong>prop</strong> (<em>float</em><em>, </em><em>optional</em>) – the proportion of infrequent levels to lump. Defaults to 0.05.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.series (with category dtype converted to object, if applicable)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>from balance.util import fct_lump
import pandas as pd</p>
<p>s = pd.Series([‘a’,’a’,’b’,’b’,’c’,’a’,’b’], dtype = ‘category’)
fct_lump(s, 0.25)</p>
<blockquote>
<div><p># 0                a
# 1                a
# 2                b
# 3                b
# 4    _lumped_other
# 5                a
# 6                b
# dtype: object</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.fct_lump_by">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">fct_lump_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="reference internal" href="_modules/balance/util.html#fct_lump_by"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.fct_lump_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Lumps infrequent levels into ‘_lumped_other, only does so per
value of the grouping variable <cite>by</cite>. Useful, for example, for keeping the
most important interactions in a model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> (<em>pd.Series</em>) – pd.series to lump</p></li>
<li><p><strong>by</strong> (<em>pd.Series</em>) – pd.series according to which group the data</p></li>
<li><p><strong>prop</strong> (<em>float</em><em>, </em><em>optional</em>) – the proportion of infrequent levels to lump. Defaults to 0.05.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>pd.series, we keep the index of s as the index of the result.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>s = pd.Series([1,1,1,2,3,1,2])
by = pd.Series([‘a’,’a’,’a’,’a’,’a’,’b’,’b’])
fct_lump_by(s, by, 0.5)
# 0                1
# 1                1
# 2                1
# 3    _lumped_other
# 4    _lumped_other
# 5                1
# 6                2
# dtype: object</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.formula_generator">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">formula_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">formula_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'additive'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="_modules/balance/util.html#formula_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.formula_generator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Create formula to build the model matrix</dt><dd><p>Default is additive formula.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variables</strong> – list with names of variables (as strings) to combine into a formula</p></li>
<li><p><strong>formula_type</strong> (<em>str</em><em>, </em><em>optional</em>) – how to construct the formula. Currently only “additive” is supported.. Defaults to “additive”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – “This formula type is not supported.’” “Please provide a string formula”<a href="#id1"><span class="problematic" id="id2">tion_</span></a></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A string representing the fomula</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>formula_generator([‘a’,’b’,’c’])
# returns ‘c + b + a’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.guess_id_column">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">guess_id_column</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#guess_id_column"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.guess_id_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Guess the id column of a given dataset.
Possible values for guess: ‘id’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<em>pd.DataFrame</em>) – dataset to guess id column</p></li>
<li><p><strong>column_name</strong> (<em>str</em><em>, </em><em>optional</em>) – Given id column name. Defaults to None,
which will guess the id column or raise exception.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>name of guessed id column</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.model_matrix">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">model_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_na</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'two'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_var_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'dataframe'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">formula</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">penalty_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_hot_encoding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">csc_matrix</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/balance/util.html#model_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.model_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a model matrix from a sample (and target).
The default is to use an additive formula for all variables (or the ones specified).
Can also create a custom model matrix if a formula is provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sample</strong> (<a class="reference internal" href="balance.sample_class.html#balance.sample_class.Sample" title="balance.sample_class.Sample"><em>Sample</em></a>) – The Samples from which to create the model matrix</p></li>
<li><p><strong>target</strong> (<a class="reference internal" href="balance.sample_class.html#balance.sample_class.Sample" title="balance.sample_class.Sample"><em>Sample</em></a><em>, </em><em>optional</em>) – See sample. Defaults to None.</p></li>
<li><p><strong>variables</strong> (<em>_type_</em><em>, </em><em>optional</em>) – the names of the variables to include (when ‘None’ then
all joint variables to target and sample are used). Defaults to None.</p></li>
<li><p><strong>add_na</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to call add_na_indicator on the data before constructing
the matrix.If add_na = True, then the function add_na_indicator is applied,
i.e. if a column in the DataFrame contains NAs, replace these with 0 or “_NA”, and
add another column of an indicator variable for which rows were NA.
If add_na is False, observations with any missing data will be
omitted from the model. Defaults to True.</p></li>
<li><p><strong>return_type</strong> (<em>str</em><em>, </em><em>optional</em>) – whether to return a single matrix (‘one’), or a dict of
sample and target matrices. Defaults to “two”.</p></li>
<li><p><strong>return_var_type</strong> (<em>str</em><em>, </em><em>optional</em>) – whether to return a “dataframe” (pd.dataframe) a “matrix” (np.ndarray)
(i.e. only values of the output dataframe), or a “sparse” matrix. Defaults to “dataframe”.</p></li>
<li><p><strong>formula</strong> (<em>Optional</em><em>[</em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – according to what formula to construct the matrix. If no formula is provided an
additive formula is applied. This may be a string or a list of strings
representing different parts of the formula that will be concated together.
Default is None, which will create an additive formula from the aviliable variables. Defaults to None.</p></li>
<li><p><strong>penalty_factor</strong> (<em>Optional</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – the penalty used in the glment function in ipw. The penalty
should have the same length as the formula list. If not provided,
assume the same panelty for all variables. Defaults to None.</p></li>
<li><p><strong>one_hot_encoding</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to encode all factor variables in the model matrix with
one_hot_encoding_greater_2. This is recomended in case of using
LASSO on the data (Default: False).
one_hot_encoding_greater_2 creates one-hot-encoding for all
categorical variables with more than 2 categories (i.e. the
number of columns will be equal to the number of categories),
and only 1 column for variables with 2 levels (treatment contrast). Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl>
<dt>a dict of:</dt><dd><ol class="arabic simple">
<li><p>”model_matrix_columns_names”: columns names of the model matrix</p></li>
<li><p>”penalty_factor “: a penalty_factor for each column in the model matrix</p></li>
</ol>
<p>3. “model_matrix” (or: “sample” and “target”): the DataFrames for the sample and target
(one or two, according to return_type)</p>
<blockquote>
<div><p>If return_sparse=”True” returns a sparse matrix (csc_matrix)</p>
</div></blockquote>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[ str, Union[List[str], np.ndarray, Union[pd.DataFrame, np.ndarray, csc_matrix], None] ]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>import pandas as pd
d = {‘a’: [‘a1’,’a2’,’a1’,’a1’], ‘b’: [‘b1’,’b2’,’b3’,’b3’]}
df = pd.DataFrame(data=d)</p>
<p>model_matrix(df)
# {‘model_matrix_columns_names’: [‘b[b1]’, ‘b[b2]’, ‘b[b3]’, ‘a[T.a2]’],
#  ‘penalty_factor’: array([1, 1, 1, 1]),
#  ‘sample’:    b[b1]  b[b2]  b[b3]  a[T.a2]
#  0    1.0    0.0    0.0      0.0
#  1    0.0    1.0    0.0      1.0
#  2    0.0    0.0    1.0      0.0
#  3    0.0    0.0    1.0      0.0,
#  ‘target’: None}</p>
<p>model_matrix(df, formula = ‘a*b’)
# {‘model_matrix_columns_names’: [‘a[a1]’,
#   ‘a[a2]’,
#   ‘b[T.b2]’,
#   ‘b[T.b3]’,
#   ‘a[T.a2]:b[T.b2]’,
#   ‘a[T.a2]:b[T.b3]’],
#  ‘penalty_factor’: array([1, 1, 1, 1, 1, 1]),
#  ‘sample’:    a[a1]  a[a2]  b[T.b2]  b[T.b3]  a[T.a2]:b[T.b2]  a[T.a2]:b[T.b3]
#  0    1.0    0.0      0.0      0.0              0.0              0.0
#  1    0.0    1.0      1.0      0.0              1.0              0.0
#  2    1.0    0.0      0.0      1.0              0.0              0.0
#  3    1.0    0.0      0.0      1.0              0.0              0.0,
#  ‘target’: None}</p>
<p>model_matrix(df, formula = [‘a’,’b’], penalty_factor=[1,2])
# {‘model_matrix_columns_names’: [‘a[a1]’, ‘a[a2]’, ‘b[b1]’, ‘b[b2]’, ‘b[b3]’],
#  ‘penalty_factor’: array([1, 1, 2, 2, 2]),
#  ‘sample’:    a[a1]  a[a2]  b[b1]  b[b2]  b[b3]
#  0    1.0    0.0    1.0    0.0    0.0
#  1    0.0    1.0    0.0    1.0    0.0
#  2    1.0    0.0    0.0    0.0    1.0
#  3    1.0    0.0    0.0    0.0    1.0,
#  ‘target’: None}</p>
<p>model_matrix(df, formula = [‘a’,’b’], penalty_factor=[1,2], one_hot_encoding=True)
# {‘model_matrix_columns_names’: [‘C(a, one_hot_encoding_greater_2)[a2]’,
#   ‘C(b, one_hot_encoding_greater_2)[b1]’,
#   ‘C(b, one_hot_encoding_greater_2)[b2]’,
#   ‘C(b, one_hot_encoding_greater_2)[b3]’],
#  ‘penalty_factor’: array([1, 2, 2, 2]),
#  ‘sample’:    C(a, one_hot_encoding_greater_2)[a2]  …  C(b, one_hot_encoding_greater_2)[b3]
#  0                                0.0  …                                0.0
#  1                                1.0  …                                0.0
#  2                                0.0  …                                1.0
#  3                                0.0  …                                1.0
# [4 rows x 4 columns],
# ‘target’: None}</p>
<p>model_matrix(df, formula = [‘a’,’b’], penalty_factor=[1,2], return_sparse = True)
# {‘model_matrix_columns_names’: [‘a[a1]’, ‘a[a2]’, ‘b[b1]’, ‘b[b2]’, ‘b[b3]’],
#  ‘penalty_factor’: array([1, 1, 2, 2, 2]),
#  ‘sample’: &lt;4x5 sparse matrix of type ‘&lt;class ‘numpy.float64’&gt;’
#       with 8 stored elements in Compressed Sparse Column format&gt;,
#  ‘target’: None}</p>
<p>model_matrix(df, target = df)
# {‘model_matrix_columns_names’: [‘b[b1]’, ‘b[b2]’, ‘b[b3]’, ‘a[T.a2]’],
#  ‘penalty_factor’: array([1, 1, 1, 1]),
#  ‘sample’:    b[b1]  b[b2]  b[b3]  a[T.a2]
#  0    1.0    0.0    0.0      0.0
#  1    0.0    1.0    0.0      1.0
#  2    0.0    0.0    1.0      0.0
#  3    0.0    0.0    1.0      0.0,
#  ‘target’:    b[b1]  b[b2]  b[b3]  a[T.a2]
#  0    1.0    0.0    0.0      0.0
#  1    0.0    1.0    0.0      1.0
#  2    0.0    0.0    1.0      0.0
#  3    0.0    0.0    1.0      0.0}</p>
<p>model_matrix(df, target = df, return_type = “one”)
# {‘model_matrix_columns_names’: [‘b[b1]’, ‘b[b2]’, ‘b[b3]’, ‘a[T.a2]’],
#  ‘penalty_factor’: array([1, 1, 1, 1]),
#  ‘model_matrix’:    b[b1]  b[b2]  b[b3]  a[T.a2]
#  0    1.0    0.0    0.0      0.0
#  1    0.0    1.0    0.0      1.0
#  2    0.0    0.0    1.0      0.0
#  3    0.0    0.0    1.0      0.0
#  0    1.0    0.0    0.0      0.0
#  1    0.0    1.0    0.0      1.0
#  2    0.0    0.0    1.0      0.0
#  3    0.0    0.0    1.0      0.0}</p>
<p>model_matrix(df, target = df, formula=[‘a’,’b’],return_type = “one”)
# {‘model_matrix_columns_names’: [‘a[a1]’, ‘a[a2]’, ‘b[b1]’, ‘b[b2]’, ‘b[b3]’],
#  ‘penalty_factor’: array([1, 1, 1, 1, 1]),
#  ‘model_matrix’:    a[a1]  a[a2]  b[b1]  b[b2]  b[b3]
#  0    1.0    0.0    1.0    0.0    0.0
#  1    0.0    1.0    0.0    1.0    0.0
#  2    1.0    0.0    0.0    0.0    1.0
#  3    1.0    0.0    0.0    0.0    1.0
#  0    1.0    0.0    1.0    0.0    0.0
#  1    0.0    1.0    0.0    1.0    0.0
#  2    1.0    0.0    0.0    0.0    1.0
#  3    1.0    0.0    0.0    0.0    1.0}</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="balance.util.one_hot_encoding_greater_2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">one_hot_encoding_greater_2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reference</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#one_hot_encoding_greater_2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.one_hot_encoding_greater_2" title="Permalink to this definition">¶</a></dt>
<dd><p>This class creates a special encoding for factor variable to be used in a LASSO model.
For variables with exactly two levels using this in dmatrix will only keep one level, i.e.
will create one column with a 0 or 1 indicator for one of the levels. The level kept will
be the second one, based on loxicographical order of the levels.
For variables with more than 2 levels, using this in dmatrix will keep all levels
as columns of the matrix.</p>
<p>References:
1. More about this encoding:
# <a class="reference external" href="https://stats.stackexchange.com/questions/69804/group-categorical-variables-in-glmnet/107958#107958">https://stats.stackexchange.com/questions/69804/group-categorical-variables-in-glmnet/107958#107958</a>
3. Source code: adaptation of
# <a class="reference external" href="https://patsy.readthedocs.io/en/latest/categorical-coding.html">https://patsy.readthedocs.io/en/latest/categorical-coding.html</a></p>
<p>Examples:
import pandas as pd
d = {‘a’: [‘a1’,’a2’,’a1’,’a1’], ‘b’: [‘b1’,’b2’,’b3’,’b3’],</p>
<blockquote>
<div><p>‘c’: [‘c1’,’c1’,’c2’,’c1’], ‘d’:[‘d1’,’d1’,’d2’,’d3’]}</p>
</div></blockquote>
<p>df = pd.DataFrame(data=d)</p>
<p>print(dmatrix(‘C(a, one_hot_encoding_greater_2)’, df, return_type = ‘dataframe’))
#   Intercept  C(a, one_hot_encoding_greater_2)[a2]
#0        1.0                                   0.0
#1        1.0                                   1.0
#2        1.0                                   0.0
#3        1.0                                   0.0
print(dmatrix(‘C(a, one_hot_encoding_greater_2)-1’, df, return_type = ‘dataframe’))
#   C(a, one_hot_encoding_greater_2)[a2]
#0                                   0.0
#1                                   1.0
#2                                   0.0
#3                                   0.0
print(dmatrix(‘C(b, one_hot_encoding_greater_2)’, df, return_type = ‘dataframe’))
#   Intercept  C(b, one_hot_encoding_greater_2)[b1]      #0        1.0                                   1.0
#1        1.0                                   0.0
#2        1.0                                   0.0
#3        1.0                                   0.0
#
#   C(b, one_hot_encoding_greater_2)[b2]  C(b, one_hot_encoding_greater_2)[b3]
#0                                   0.0                                   0.0
#1                                   1.0                                   0.0
#2                                   0.0                                   1.0
#3                                   0.0                                   1.0
print(dmatrix(‘C(b, one_hot_encoding_greater_2)-1’, df, return_type = ‘dataframe’))
#   C(b, one_hot_encoding_greater_2)[b1]  C(b, one_hot_encoding_greater_2)[b2]      #0                                   1.0                                   0.0
#1                                   0.0                                   1.0
#2                                   0.0                                   0.0
#3                                   0.0                                   0.0
#
#   C(b, one_hot_encoding_greater_2)[b3]
#0                                   0.0
#1                                   0.0
#2                                   1.0</p>
<p>d = {‘a’: [‘a1’,’a1’,’a1’,’a1’], ‘b’: [‘b1’,’b2’,’b3’,’b3’]}
df = pd.DataFrame(data=d)</p>
<p>print(dmatrix(‘C(a, one_hot_encoding_greater_2)-1’, df, return_type = ‘dataframe’))
print(dmatrix(‘C(a, one_hot_encoding_greater_2):C(b, one_hot_encoding_greater_2)-1’, df, return_type = ‘dataframe’))   C(a, one_hot_encoding_greater_2)[a1]
#0                                   1.0
#1                                   1.0
#2                                   1.0
#3                                   1.0
#   C(a, one_hot_encoding_greater_2)[a1]:C(b, one_hot_encoding_greater_2)[b1]      #0                                                1.0
#1                                                0.0
#2                                                0.0
#3                                                0.0
#
#   C(a, one_hot_encoding_greater_2)[a1]:C(b, one_hot_encoding_greater_2)[b2]      #0                                                0.0
#1                                                1.0
#2                                                0.0
#3                                                0.0</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.process_formula">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">process_formula</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">formula</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor_variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#process_formula"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.process_formula" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>Process a formula string:</dt><dd><ol class="arabic simple">
<li><p>Expand .  notation using dot_expansion function</p></li>
<li><p>Remove intercept (if using ipw, it will be added automatically by cvglment)</p></li>
</ol>
<p>3. If factor_variables is not None, one_hot_encoding_greater_2 is applied
to factor_variables</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>formula</strong> – A string representing the formula</p></li>
<li><p><strong>variables</strong> (<em>List</em>) – list of all variables to include (usually all variables in data)</p></li>
<li><p><strong>factor_variables</strong> – list of names of factor variables that we use
one_hot_encoding_greater_2 for. Note that these should be also
part of variables.
Default is None, in which case no special contrasts are
applied (using patsy defaults). one_hot_encoding_greater_2
creates one-hot-encoding for all categorical variables with
more than 2 categories (i.e. the number of columns will
be equal to the number of categories), and only 1
column for variables with 2 levels (treatment contrast).</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – “Not all factor variables are contained in variables”</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a ModelDesc object to build a model matrix using patsy.dmatrix.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>f1 = process_formula(‘a:(b+aab)’, [‘a’,’b’,’aab’])
print(f1)
# ModelDesc(lhs_termlist=[],
#       rhs_termlist=[Term([EvalFactor(‘a’), EvalFactor(‘b’)]),
#                     Term([EvalFactor(‘a’), EvalFactor(‘aab’)])])
f2 = process_formula(‘a:(b+aab)’, [‘a’,’b’,’aab’], [‘a’,’b’])
print(f2)
# ModelDesc(lhs_termlist=[],
#       rhs_termlist=[Term([EvalFactor(‘C(a, one_hot_encoding_greater_2)’),
#                           EvalFactor(‘C(b, one_hot_encoding_greater_2)’)]),
#                     Term([EvalFactor(‘C(a, one_hot_encoding_greater_2)’),
#                           EvalFactor(‘aab’)])])</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.qcut">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">qcut</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicates</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'drop'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/balance/util.html#qcut"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.qcut" title="Permalink to this definition">¶</a></dt>
<dd><p>Discretize variable into equal-sized buckets based quantiles.
This is a wrapper to pandas qcut function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s</strong> (<em>_type_</em>) – 1d ndarray or Series.</p></li>
<li><p><strong>q</strong> (<em>_type_</em>) – Number of quantiles (int or float).</p></li>
<li><p><strong>duplicates</strong> (<em>str</em><em>, </em><em>optional</em>) – whther to drop non unique bin edges or raise error (“raise” or “drop”).
Defaults to “drop”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Series of type object with intervals.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.quantize">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">quantize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Series</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="_modules/balance/util.html#quantize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.quantize" title="Permalink to this definition">¶</a></dt>
<dd><p>Cut numeric variables of a DataFrame into quantile buckets</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>Union</em><em>[</em><em>pd.DataFrame</em><em>, </em><em>pd.Series</em><em>]</em>) – ataFrame to transform</p></li>
<li><p><strong>q</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of buckets to create for each variable. Defaults to 10.</p></li>
<li><p><strong>variables</strong> (<em>optional</em>) – variables to transform.
If None, all numeric variables are transformed. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame after quantization</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>_type_</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.rm_mutual_nas">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">rm_mutual_nas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span></span></span><a class="reference internal" href="_modules/balance/util.html#rm_mutual_nas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.rm_mutual_nas" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove entries in a position which is na or infinite in any of the arguments</p>
<p>Ignores args which are None</p>
<p>can accept array-like or single arraylike argument. Including pandas and numpy arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If args are not array like (see: <code class="xref py py-func docutils literal notranslate"><span class="pre">_is_arraylike()</span></code>)</p></li>
<li><p><strong>ValueError</strong> – If args include arrays of different lengths.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list with all the original vectors, after removing from them the</dt><dd><p>elements for which there was a missing value in the same position as
any of the other arrays.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>import pandas as pd
import numpy as np</p>
<p>x1 = pd.array([1,2, None, np.nan, pd.NA, 3])
x2 = pd.array([1.1,2,3, None, np.nan, pd.NA])
x3 = pd.array([1.1,2,3, 4,5,6])
x4 = pd.array([“1.1”,2,3, None, np.nan, pd.NA])
x5 = pd.array([“1.1”,”2”,”3”, None, np.nan, pd.NA], dtype = “string”)
x6 = np.array([1,2,3.3,4,5,6])
x7 = np.array([1,2,3.3,4,”5”,”6”])
x8 = [1,2,3.3,4,”5”,”6”]
(x1,x2, x3, x4, x5, x6, x7, x8)</p>
<blockquote>
<div><p># (&lt;IntegerArray&gt;
# [1, 2, &lt;NA&gt;, &lt;NA&gt;, &lt;NA&gt;, 3]
# Length: 6, dtype: Int64,
# &lt;PandasArray&gt;
# [1.1, 2, 3, None, nan, &lt;NA&gt;]
# Length: 6, dtype: object,
# &lt;PandasArray&gt;
# [1.1, 2.0, 3.0, 4.0, 5.0, 6.0]
# Length: 6, dtype: float64,
# &lt;PandasArray&gt;
# [‘1.1’, 2, 3, None, nan, &lt;NA&gt;]
# Length: 6, dtype: object,
# &lt;StringArray&gt;
# [‘1.1’, ‘2’, ‘3’, &lt;NA&gt;, &lt;NA&gt;, &lt;NA&gt;]
# Length: 6, dtype: string,
# array([1. , 2. , 3.3, 4. , 5. , 6. ]),
# array([‘1’, ‘2’, ‘3.3’, ‘4’, ‘5’, ‘6’], dtype=’&lt;U32’),
# [1, 2, 3.3, 4, ‘5’, ‘6’])</p>
</div></blockquote>
<p>from balance.util import rm_mutual_nas
rm_mutual_nas(x1,x2, x3, x4, x5,x6,x7,x8)</p>
<blockquote>
<div><p># [&lt;IntegerArray&gt;
#  [1, 2]
#  Length: 2, dtype: Int64,
#  &lt;PandasArray&gt;
#  [1.1, 2]
#  Length: 2, dtype: object,
#  &lt;PandasArray&gt;
#  [1.1, 2.0]
#  Length: 2, dtype: float64,
#  &lt;PandasArray&gt;
#  [‘1.1’, 2]
#  Length: 2, dtype: object,
#  &lt;StringArray&gt;
#  [‘1.1’, ‘2’]
#  Length: 2, dtype: string,
#  array([1., 2.]),
#  array([‘1’, ‘2’], dtype=’&lt;U32’),
#  [1, 2]]</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balance.util.row_pairwise_diffs">
<span class="sig-prename descclassname"><span class="pre">balance.util.</span></span><span class="sig-name descname"><span class="pre">row_pairwise_diffs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="_modules/balance/util.html#row_pairwise_diffs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#balance.util.row_pairwise_diffs" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce the differences between every pair of rows of df</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – DataFrame</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame with differences between all combinations of rows</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>d = pd.DataFrame({“a”: (1, 2, 3), “b”: (-42, 8, 2)})
row_pairwise_diffs(d)
#        a   b
# 0      1 -42
# 1      2   8
# 2      3   2
# 1 - 0  1  50
# 2 - 0  2  44
# 2 - 1  1  -6</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">balance.util</a><ul>
<li><a class="reference internal" href="#balance.util.TruncationFormatter"><code class="docutils literal notranslate"><span class="pre">TruncationFormatter</span></code></a><ul>
<li><a class="reference internal" href="#balance.util.TruncationFormatter.format"><code class="docutils literal notranslate"><span class="pre">TruncationFormatter.format()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#balance.util.add_na_indicator"><code class="docutils literal notranslate"><span class="pre">add_na_indicator()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.auto_spread"><code class="docutils literal notranslate"><span class="pre">auto_spread()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.build_model_matrix"><code class="docutils literal notranslate"><span class="pre">build_model_matrix()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.choose_variables"><code class="docutils literal notranslate"><span class="pre">choose_variables()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.dot_expansion"><code class="docutils literal notranslate"><span class="pre">dot_expansion()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.drop_na_rows"><code class="docutils literal notranslate"><span class="pre">drop_na_rows()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.fct_lump"><code class="docutils literal notranslate"><span class="pre">fct_lump()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.fct_lump_by"><code class="docutils literal notranslate"><span class="pre">fct_lump_by()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.formula_generator"><code class="docutils literal notranslate"><span class="pre">formula_generator()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.guess_id_column"><code class="docutils literal notranslate"><span class="pre">guess_id_column()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.model_matrix"><code class="docutils literal notranslate"><span class="pre">model_matrix()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.one_hot_encoding_greater_2"><code class="docutils literal notranslate"><span class="pre">one_hot_encoding_greater_2</span></code></a></li>
<li><a class="reference internal" href="#balance.util.process_formula"><code class="docutils literal notranslate"><span class="pre">process_formula()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.qcut"><code class="docutils literal notranslate"><span class="pre">qcut()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.quantize"><code class="docutils literal notranslate"><span class="pre">quantize()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.rm_mutual_nas"><code class="docutils literal notranslate"><span class="pre">rm_mutual_nas()</span></code></a></li>
<li><a class="reference internal" href="#balance.util.row_pairwise_diffs"><code class="docutils literal notranslate"><span class="pre">row_pairwise_diffs()</span></code></a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="balance.typing.html"
                          title="previous chapter">balance.typing</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="balance.weighting_methods.html"
                          title="next chapter">balance.weighting_methods</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/balance.util.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="balance.weighting_methods.html" title="balance.weighting_methods"
             >next</a> |</li>
        <li class="right" >
          <a href="balance.typing.html" title="balance.typing"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">balance  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="balance.html" >balance</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">balance.util</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>